# 機能: HR 人材紹介ドメインコンテキスト注入

## 概要

ユーザー入力に人材紹介業界のキーワードが含まれる場合、
業界特有のファネルモデル・構造的課題・マッチング変数を AI プロンプトに自動注入し、
より専門的な分析を生成する。

## ユーザーストーリー

- 人材紹介エージェントの営業として、CA（キャリアアドバイザー）の生産性向上策を AI に分析させたい
- エージェント企業の経営企画として、求職者ファネルのボトルネックを特定したい

## HR キーワード検出

以下の正規表現でプロダクト名・課題テキストを照合:

```
/人材|採用|エージェント|CA|転職|求人|スカウト|人事|キャリア/i
```

関数: `isHRContext(productService, issueTexts)` → `boolean`

## 注入されるドメイン知識

### 求職者ファネル（SEEKER_FUNNEL）

| ステージ | 指標 |
|---------|------|
| 認知 | 求職者リーチ数 |
| 登録 | エントリー率 |
| 面談 | 面談実施率 |
| 紹介 | 求人マッチング率 |
| 応募 | 応募率 |
| 内定承諾 | 決定率 |

### クライアントファネル（CLIENT_FUNNEL）

| ステージ | 指標 |
|---------|------|
| リード | 新規企業獲得 |
| 契約 | 契約締結率 |
| 受注 | 成約率 |
| リピート | リピート率 |

### 構造的課題（HIDDEN_ISSUES）

- エージェント不信（求職者・企業双方）
- 属人化（CA個人のスキルに依存）
- 情報の非対称性（求人票と実態の乖離）
- マッチングの質（スキルだけでなくカルチャーフィット）
- 離職リスク（入社後の早期離職）

### マッチング変数（MATCHING_VARS）

- スキルマッチ
- カルチャーフィット
- 期待値ギャップ

## 出力への影響

HR コンテキスト検出時、`AIResults` に追加フィールドが出力される:
- `keyIssue`: ファネル分析に基づく最重要イシュー
- `funnelStage`: ボトルネックとなっている段階

## Pro / Free モードの差異

| モード | コンテキスト量 | 内容 |
|--------|-------------|------|
| Pro | ~400 トークン | ファネル詳細 + 構造的課題 + マッチング変数の完全版 |
| Free | ~100 トークン | 圧縮版（ファネル概要のみ） |

## 実装ファイル

| ファイル | 関数/行 |
|---------|---------|
| `src/constants/domainContext.ts` | `isHRContext()` (L43-45), `SEEKER_FUNNEL`, `CLIENT_FUNNEL`, `HIDDEN_ISSUES`, `MATCHING_VARS`, `getHRContext()` (L52-78) |
| `src/hooks/useAI.ts` | `buildPrompt()` 内で `isHRContext()` チェック → `getHRContext()` 注入 |

## 制約

- HR キーワード検出は正規表現ベース（NLP/ML は不使用）
- ドメインコンテキストはハードコード（DB 不使用）
- 非 HR セッションでは注入しない（トークン節約）

## 受入基準

- [ ] HR キーワードを含む入力で keyIssue と funnelStage が出力される
- [ ] HR キーワードを含まない入力では追加コンテキストが注入されない
- [ ] Pro モードで詳細版、Free モードで圧縮版が注入される
- [ ] ファネル各ステージが AI の分析に反映される
